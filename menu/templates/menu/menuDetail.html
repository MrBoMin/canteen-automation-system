{% extends 'base.html' %}
{% block style_block %}
<style>
    .product-container {
        max-width: 1549px;
        width: 100%;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-left: 10%;
        margin-top: 50px;
    }

    .product-details {
        display: flex;
        gap: 40px;
    }

    .product-image {
        width: 60%;
        border-radius: 8px;
        overflow: hidden;
    }

    .product-image img {
        width: 700px;
        height: 537px;
        display: block;
    }

    .product-info {
        width: 80%;
    }

    .product-title {
        font-size: 1.8em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .product-price {
        font-size: 2.4em;
        color: #333;
        margin-bottom: 5px;
    }

    .product-price del {
        color: #888;
        margin-right: 10px;
    }

    .rating {
        font-size: 1em;
        color: #ff9800;
        margin-bottom: 15px;
    }

    .product-description {
        font-size: 1.2em;
        color: #555;
        line-height: 1.5;
        margin-bottom: 20px;
        height: 200px;
        margin-top: 12px;
    }

    .quantity-selection {
        display: flex;
        /* align-items: center; */
        margin-bottom: 20px;
        align-content: stretch;
        flex-direction: column;
    }

    .quantity-selection span {
        margin-right: 10px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .quantity-controls {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .quantity-controls button {
        background-color: #003366;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        transition: all 0.3s ease;
    }

    .quantity-controls button:hover {
        background-color: #0056b3;
    }

    .quantity-controls input {
        width: 63px;
        text-align: center;
        border: 1px solid #ddd;
        /* padding: 5px; */
        border-radius: 50px;
        height: 37px;
    }

    .quantity-controls label {
        font-size: 20px;
    }


    .product-actions {
        display: flex;
        gap: 20px;
    }

    .product-actions button {
        background-color: #003366;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .product-actions button:hover {
        background-color: #00509e;
    }

    .reviews-section h3 {
        font-size: 21px;
        font-weight: lighter;
        /* margin-bottom: 10px; */
        color: white;
        background: #003366;
        width: 134px;
        text-align: center;
        height: 53px;
        padding: 10px;
        border-radius: 5px 5px 0px 0px;
    }

    .reviews-container {
        display: flex;
        gap: 20px;
    }

    .reviews-list {
        background-color: #003366;
        color: white;
        padding: 20px;
        border-radius: 8px;
        width: 100%;
        height: 91%;
    }

    .review {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 40px;
        margin-top: 18px;
    }

    .review img {
        max-width: 80px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid white;
        flex: 1;
    }

    .review-content {
        flex: 1;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        margin-bottom: 5px;
        /* text-align: left; */
        width: 305px;
    }

    .review-text {
        font-size: 1.5em;
        color: #eee;
        margin-top: 5px;
    }

    .review-form {
        width: 100%;
        background-color: #003366;
        color: white;
        padding: 20px;
        border-radius: 8px;
    }

    .review-form h4 {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .review-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .review-form input,
    .review-form textarea {
        width: 100%;
        padding: 8px;
        font-size: 0.9em;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .review-form textarea {
        resize: vertical;
        height: 80px;
    }

    .review-form .submit-btn:hover {
        background-color: #00509e;
    }

    .image-carousel {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
        position: relative;
        width: 620px;
        justify-content: space-evenly;
    }

    .carousel-images {
        display: flex;
        overflow-x: hidden;
        scroll-behavior: smooth;
        gap: 10px;
        max-width: 500px;
        /* margin-left: 38px; */
        flex-wrap: nowrap;
        justify-content: space-around;
        width: 457px;
    }

    .carousel-images img {
        width: 100px;
        height: 80px;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .carousel-btn {
        background-color: #003366;
        color: white;
        border: none;
        padding: 8px;
        /* border-radius: 50%; */
        cursor: pointer;
        font-size: 18px;
        height: 100%;
    }

    .carousel-btn:hover {
        background-color: #00509e;
    }

    .left-btn {
        position: absolute;
        left: 0px;
    }

    .right-btn {
        position: absolute;
        right: 0px;
    }

    .reviews-section {
        width: 100%;
        max-width: 1200px;
        margin-top: 60px;
    }

    .reviews-section h3 {
        font-size: 1.4em;
        font-weight: bold;
    }

    .reviews-container {
        display: flex;
        gap: 20px;
    }

    .reviews-list h4 {
        font-size: 1.2em;
        margin-bottom: 20px;
    }

    .review-content {
        flex: 1;
    }

    .reviewer-name {
        color: white;
    }

    .review-date {
        color: #ddd;
        font-size: 0.9em;
    }

    .review-rating {
        color: #ff9800;
        font-size: 0.9em;
    }

    .review-text {
        font-size: 0.9em;
        color: #eee;
        margin-top: 5px;
    }

    .review-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .review-form h4 {

        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .review-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        font-size: 1.2em;
    }

    .review-form select {
        padding: 1em;
        border-radius: 5px;
    }

    .review-form input,
    .review-form textarea {
        width: 100%;
        padding: 8px;
        font-size: 1em;
        margin-bottom: 10px;
        border: none;
        border-radius: 4px;
    }

    .review-form textarea {
        resize: vertical;
        height: 100px;
    }

    .submit-btn {
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        width: 47%;
        color: #003366;
        background: white;
        transition: all 0.3s ease;
        font-size: 1em;
    }

    .submit-btn:hover {
        background-color: #00509e;
        color: white;
    }

    .fav-btn {
        text-decoration: none;
        color: white;
    }
</style>
{% endblock style_block %}
{% block content %}
<div class="product-container" style="margin-bottom: 48px !important;">
    <div class="product-details">
        <div class="product-image">
            <img src="{{ menu_item.photo.url }}" alt="{{ menu_item.item_name }}">
        </div>
        <div class="product-info">
            <h1 class="product-title">{{ menu_item.item_name }}</h1>
            <p class="product-price">$ {{ menu_item.price }}</p>
            <p class="product-description">{{ menu_item.description }}</p>
            <p class="product-stock">Stock Available: {{ menu_item.stock }}</p>
            <p class="product-restock-level">Restock Level: {{ menu_item.restock_level }}</p>
         
            <div class="product-actions" style="margin-top: 48px;">
                <button onclick="addToCart({{ menu_item.id }})" class="add-to-cart">Add to Cart</button>

                <form method="post" action="{% url 'menu:toggle_favorite' menu_item.pk %}">
                    {% csrf_token %}
                    {% if is_favorite %}
                    <button type="submit" class="favorite-button">Remove from Favorites ‚ù§Ô∏è</button>
                    {% else %}
                    <button type="submit" class="favorite-button">Add to Favorites ü§ç</button>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <div class="reviews-section" style="padding: 12px !important;">
        <h3>Reviews</h3>
        <hr style="border-top: 1px solid black;">
        <div class="reviews-container"">
            <!-- Review List -->
            <div style=" width: 60%;">
            <h4 style="margin: 10px; margin-left: 0px;">{{ reviews|length }} Reviews</h4>
            <div class="reviews-list">
                {% for review in reviews %}
                <div class="review">
                    <img src="{{ review.user.profile_picture.url }}" alt="{{ review.user.username }}">
                    <div class="review-content">
                        <div class="review-header">
                            <span class="reviewer-name">{{ review.user.username }}</span>
                            <span class="review-date">{{ review.created_at|date:"d M Y" }}</span>
                            <span class="review-rating">{{ review.rating }} ‚òÖ</span>
                        </div>
                        <p class="review-text">{{ review.comment }}</p>
                    </div>
                </div>
                {% empty %}
                <p>No reviews yet. Be the first to review!</p>
                {% endfor %}
            </div>

        </div>

        <!-- Review Form -->
        <div style="width: 40%;">
            <h4 style="margin: 10px; margin-left: 0px;">Write A Review</h4>
            <form method="post" action="{% url 'menu:submit_review' menu_item.pk %}" class="review-form">
                {% csrf_token %}
                <label for="rating">Select Your Rating:</label>
                <select name="rating" id="rating" required>
                    <option value="">--Choose a Rating--</option>
                    {% for i in "12345" %}
                    <option value="{{ i }}">{{ i }} Stars</option>
                    {% endfor %}
                </select>

                <label for="review">Write Your Review:</label>
                <textarea name="comment" id="review" placeholder="Write your review here" required></textarea>

                <button type="submit" class="submit-btn">Submit Review</button>
            </form>
        </div>
    </div>
</div>
</div>
{% endblock content %}
{% block script_block %}
{% load static %}
<script src="{% static 'js/headfoot.js' %}"></script>
<script>
    const leftBtn = document.querySelector('.left-btn');
    const rightBtn = document.querySelector('.right-btn');
    const carousel = document.querySelector('.carousel-images');

    leftBtn.addEventListener('click', () => {
        carousel.scrollBy({
            left: -100,
            behavior: 'smooth'
        });
    });

    rightBtn.addEventListener('click', () => {
        carousel.scrollBy({
            left: 100,
            behavior: 'smooth'
        });
    });

    function updateTotal(input) {
        const row = input.closest('.quantity-selection');
        const priceText = row.closest('.product-info').querySelector('p.product-price').textContent;
        const priceMatch = priceText.match(/(\d+)\s*MMK$/);
        if (priceMatch) {
            const price = parseInt(priceMatch[1]);
            const quantity = parseInt(input.value);
            const total = price * quantity;
            row.querySelector('.item-price').textContent = total;
        }
    }

    function incrementQuantity(button) {
        const input = button.previousElementSibling;
        input.value = parseInt(input.value) + 1;
        updateTotal(input);
    }

    function decrementQuantity(button) {
        const input = button.nextElementSibling;
        if (input.value > 1) {
            input.value = parseInt(input.value) - 1;
            updateTotal(input);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const foodCards = Array.from(document.querySelectorAll('.review'));
        const paginationContainer = document.querySelector('.pagination');
        const itemsPerPage = 3; // Number of items per page

        let currentPage = 1;
        const totalPages = Math.ceil(foodCards.length / itemsPerPage);

        const renderFoodCards = () => {
            foodCards.forEach((card) => (card.style.display = 'none'));

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;

            foodCards.slice(start, end).forEach((card) => {
                card.style.display = 'flex';
            });
        };

        const updatePagination = () => {
            paginationContainer.innerHTML = '';

            const prevButton = document.createElement('button');
            prevButton.innerHTML = '<i class="fa-solid fa-arrow-left"></i>';
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderFoodCards();
                    updatePagination();
                }
            });
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderFoodCards();
                    updatePagination();
                });
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.innerHTML = '<i class="fa-solid fa-arrow-right"></i>';
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderFoodCards();
                    updatePagination();
                }
            });
            paginationContainer.appendChild(nextButton);
        };

        renderFoodCards();
        updatePagination();
    });

    function addToCart(itemId) {
        fetch(`/orders/cart/add/${itemId}/`, {  // Updated to point to 'order' app
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({})
        })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                }
                // Update cart count dynamically
                document.getElementById('cart-count').textContent = data.cart_count;
            });
    }
</script>
{% endblock script_block %}